<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>💌 Unspoken Hearts</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand&display=swap');
    * {
      transition: background-color 0.3s, color 0.3s;
    }
    body {
      font-family: 'Quicksand', sans-serif;
      background-color: #fff0f5;
      color: #333;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      overflow-x: hidden;
      position: relative;
    }
    body.dark {
      background-color: #1e1e1e;
      color: #e0e0e0;
    }
    h1 {
      text-align: center;
      font-size: 40px;
      font-family: 'Pacifico', cursive;
      color: #ff69b4;
    }
    .diary-entry {
      background: #fffafc;
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 15px;
    }
    body.dark .diary-entry { background-color: #2a2a2a; color: #e0e0e0; }
    textarea, input, select, button {
      width: 100%; padding: 10px; margin-top: 10px; border-radius: 12px; box-sizing: border-box;
    }
    body.dark textarea, body.dark input, body.dark select {
      background-color: #333; color: white; border: 1px solid #666;
    }
    button:hover { background-color: #ff69b4; color: white; cursor: pointer; }
    #darkToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ff69b4;
      color: white;
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 9999;
    }
    #scrollTopBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ff69b4;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <h1>💌 Unspoken Hearts</h1>
  <button id="darkToggle" onclick="toggleDarkMode()">🌙 Dark Mode</button>
  <button id="scrollTopBtn" onclick="scrollToTop()">🔼</button>

  <label for="fontSize">Font Size:</label>
  <select id="fontSize" onchange="changeFontSize()">
    <option value="small">Small</option>
    <option value="medium" selected>Medium</option>
    <option value="large">Large</option>
  </select>

  <textarea id="entryText" placeholder="Write something..."></textarea>
  <input type="file" id="entryImage" accept="image/*">
  <button onclick="submitEntry()">Submit</button>

  <div id="entries"></div>

  <script>
    const PASSWORD = "usdiary2025";
    const IMAGEBB_API_KEY = "1466e5972116e365b26ad42b2679d379";

    const firebaseConfig = {
      apiKey: "AIzaSyDtHj92IVoxoyz2EtMVaaHVKyPP7UHDpEU",
      authDomain: "unspoken-hearts-diary.firebaseapp.com",
      projectId: "unspoken-hearts-diary"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const entryText = document.getElementById("entryText");
    const entryImage = document.getElementById("entryImage");
    const entriesContainer = document.getElementById("entries");

    function toggleDarkMode() {
      const isDark = document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", isDark);
      document.getElementById("darkToggle").innerText = isDark ? "☀️ Light Mode" : "🌙 Dark Mode";
    }

    if (localStorage.getItem("darkMode") === "true" ||
       (!localStorage.getItem("darkMode") && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      document.body.classList.add("dark");
    }
    document.addEventListener("DOMContentLoaded", () => {
      const isDark = document.body.classList.contains("dark");
      document.getElementById("darkToggle").innerText = isDark ? "☀️ Light Mode" : "🌙 Dark Mode";
      loadEntries();
    });

    window.onscroll = () => {
      document.getElementById("scrollTopBtn").style.display = window.scrollY > 100 ? "flex" : "none";
    }
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function changeFontSize() {
      const size = document.getElementById("fontSize").value;
      if (size === "small") entryText.style.fontSize = "14px";
      else if (size === "medium") entryText.style.fontSize = "16px";
      else if (size === "large") entryText.style.fontSize = "18px";
      localStorage.setItem("fontSize", size);
    }

    entryText.addEventListener("input", () => {
      localStorage.setItem("draftText", entryText.value);
    });

    window.addEventListener("DOMContentLoaded", () => {
      const savedDraft = localStorage.getItem("draftText");
      if (savedDraft) entryText.value = savedDraft;
      const savedSize = localStorage.getItem("fontSize") || "medium";
      document.getElementById("fontSize").value = savedSize;
      changeFontSize();
    });

    function submitEntry() {
      const text = entryText.value.trim();
      const file = entryImage.files[0];
      if (!text && !file) return alert("Please write something or add an image.");

      const entryData = {
        text,
        timestamp: Date.now(),
        password: PASSWORD
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = function () {
          const base64 = reader.result.split(",")[1];
          fetch(`https://api.imgbb.com/1/upload?key=${IMAGEBB_API_KEY}`, {
            method: "POST",
            body: new URLSearchParams({ image: base64 })
          })
            .then(res => res.json())
            .then(data => {
              entryData.image = data.data.url;
              saveEntry(entryData);
            });
        };
        reader.readAsDataURL(file);
      } else {
        saveEntry(entryData);
      }
    }

    function saveEntry(data) {
      db.collection("entries").add(data).then(() => {
        alert("Entry uploaded!");
        localStorage.removeItem("draftText");
        entryText.value = "";
        entryImage.value = "";
        loadEntries();
      });
    }

    function loadEntries() {
      entriesContainer.innerHTML = "";
      db.collection("entries").orderBy("timestamp", "desc").get().then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.password !== PASSWORD) return;
          const div = document.createElement("div");
          div.className = "diary-entry";
          const date = new Date(data.timestamp).toLocaleString();
          div.innerHTML = `<small>${date}</small><p>${data.text}</p>${data.image ? `<img src="${data.image}" style="max-width:100%; border-radius:10px;">` : ""}`;
          entriesContainer.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
